FROM python:3.11-slim-bullseye  # Usa una versión base específica

# 1. Instalar dependencias del sistema necesarias para WeasyPrint y compilación
RUN apt-get update && apt-get install -y --no-install-recommends \
    # Bibliotecas GRÁFICAS y RENDERIZADO (Críticas para WeasyPrint)
    libcairo2 \
    libcairo2-dev \
    libpango-1.0-0 \
    libpangocairo-1.0-0 \
    libgdk-pixbuf-2.0-0 \
    libgdk-pixbuf2.0-0 \
    # Biblioteca GOOBJECT (¡Esta es la que te falta!)
    libgobject-2.0-0 \
    # Bibliotecas de FUENTES y TEXTO
    libharfbuzz0b \
    libharfbuzz-subset0 \
    libfontconfig1 \
    # Bibliotecas de DESARROLLO para compilar extensiones Python
    libffi-dev \
    libjpeg-dev \
    libgirepository1.0-dev \
    libglib2.0-dev \
    pkg-config \
    # Herramientas de COMPILACIÓN para instalar paquetes Python
    build-essential \
    gcc \
    # Herramientas del SISTEMA
    wget \
    && rm -rf /var/lib/apt/lists/*

# 2. Establecer directorio de trabajo
WORKDIR /app

# 3. Copiar requirements ANTES del código para aprovechar la caché de Docker
COPY requirements.txt .

# 4. Instalar dependencias de Python
RUN pip install --no-cache-dir --upgrade pip \
    && pip install --no-cache-dir -r requirements.txt

# 5. Copiar el resto del código de la aplicación
COPY . .

# 6. Comando para iniciar la aplicación Django
# Asegúrate de que "proyectoDjango.wsgi" coincida con el nombre de tu proyecto
CMD ["gunicorn", "proyectoDjango.wsgi:application", "--bind", "0.0.0.0:8000"]
